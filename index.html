<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
<title>Honey School · PLNT Earth</title>
<meta name="theme-color" content="#0b0d11">
<style>
:root{
  --bg:#0b0d11;
  --ink:#eef1fa;
  --muted:#aeb6c9;
  --glass:rgba(255,255,255,.06);
  --glass-2:rgba(255,255,255,.1);
  --honey:#ffd782;
  --accent:#b7a7ff;
  --ring:0 0 0 3px rgba(255,215,130,.45);
  --shadow:0 10px 30px rgba(0,0,0,.45), inset 0 1px 0 rgba(255,255,255,.04);
  color-scheme: dark;
}
*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0;background:
  radial-gradient(1200px 800px at 70% -10%,rgba(255,215,130,.08),transparent 60%),
  linear-gradient(180deg,#0b0d11,#0b0d11 60%,#080a0f);
  color:var(--ink);font:500 16px/1.55 ui-sans-serif,system-ui,Segoe UI,Roboto,Apple Color Emoji;
  -webkit-font-smoothing:antialiased;text-rendering:optimizeLegibility;
}
a{color:inherit;text-decoration:none}
button{cursor:pointer;border:0}
kbd{font:600 11px/1 ui-monospace, SFMono-Regular, Menlo, monospace;background:#141722;border:1px solid rgba(255,255,255,.15);padding:4px 6px;border-radius:6px;color:#bcd}
.wrap{max-width:1100px;margin:0 auto;padding:16px}

.header{
  display:flex;align-items:center;gap:14px;position:sticky;top:0;z-index:10;
  background:linear-gradient(180deg,rgba(11,13,17,.9),rgba(11,13,17,.65) 80%,transparent);
  backdrop-filter:saturate(140%) blur(10px);padding:12px;border-radius:0 0 18px 18px;box-shadow:0 10px 30px rgba(0,0,0,.25)
}
.logo{width:40px;height:40px;border-radius:12px;background:
  conic-gradient(from 210deg at 50% 50%,#ffd782,#b7a7ff,#ffd782,#fff2c0);
  box-shadow:0 0 0 2px rgba(255,255,255,.08), inset 0 0 40px rgba(255,255,255,.25)}
.h1{font-size:18px;letter-spacing:.6px}
.h2{font-size:12px;color:var(--muted)}

.grid{display:grid;grid-template-columns:7fr 5fr;gap:14px;margin-top:14px}
@media (max-width:980px){.grid{grid-template-columns:1fr}}

.card{
  background:linear-gradient(180deg,rgba(255,255,255,.04),rgba(255,255,255,.02));
  border:1px solid rgba(255,255,255,.08); border-radius:18px; box-shadow:var(--shadow)
}
.section{padding:12px}
.meta{color:var(--muted);font-size:12px}
.btn{
  padding:11px 14px;border-radius:12px;background:var(--honey);color:#0b0d11;font-weight:800;letter-spacing:.3px
}
.btn.ghost{background:var(--glass);color:var(--ink);border:1px solid rgba(255,255,255,.1)}
.btn.dark{background:#151a22;color:var(--ink);border:1px solid rgba(255,255,255,.1)}
.row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
.bar{display:flex;gap:8px;align-items:center;padding:10px;background:rgba(255,255,255,.05);border-bottom:1px solid rgba(255,255,255,.08);border-radius:18px 18px 0 0}
.badge{display:flex;gap:8px;align-items:center;padding:8px 10px;border-radius:999px;background:var(--glass)}
.dot{width:12px;height:12px;border-radius:6px;background:var(--honey);box-shadow:0 0 16px #ffd78280}

/* Player */
.player{padding:12px}
#yt{width:100%;aspect-ratio:16/9;border-radius:14px;border:1px solid rgba(255,255,255,.08);background:#0f1117}
.title{font-weight:800;margin-top:8px}
.controls{display:flex;gap:8px;margin-top:8px;flex-wrap:wrap}
.small{font-size:12px}
.sel, .input{
  appearance:none;width:100%;padding:10px 12px;border-radius:12px;border:1px solid rgba(255,255,255,.12);
  background:#121621;color:var(--ink);font-weight:700;letter-spacing:.3px
}
.sel option{background:#0b0d11;color:#e9ecf5}
.input::placeholder{color:#8aa}
.list{margin-top:10px;max-height:220px;overflow:auto;display:grid;gap:8px}
.item{display:flex;align-items:center;gap:8px;padding:10px;border-radius:12px;background:var(--glass);border:1px solid rgba(255,255,255,.08)}
.item[aria-current="true"]{outline:var(--ring);background:rgba(255,215,130,.12)}
.num{width:22px;height:22px;border-radius:7px;background:rgba(255,255,255,.05);display:grid;place-items:center;font-size:12px}
.bad{color:#f88}

/* Tone Studio */
.tone{padding:12px}
.slider{width:160px}
.mini{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
.kit{display:flex;gap:8px;flex-wrap:wrap}
.pill{padding:8px 10px;border-radius:999px;background:var(--glass);border:1px solid rgba(255,255,255,.08);font-size:12px}
.timer{display:flex;gap:8px;align-items:center}

/* Ritual */
.rit{padding:12px}
.step{padding:10px;border-radius:12px;background:rgba(255,255,255,.05);border:1px dashed rgba(255,255,255,.12);display:grid;gap:6px}
.footer{margin:16px 0 8px;text-align:center;color:var(--muted);font-size:12px}
</style>
</head>
<body>
<div class="wrap">
  <header class="header card">
    <div class="logo" aria-hidden="true"></div>
    <div>
      <div class="h1">Honey School</div>
      <div class="h2">Taste · Magnetism · Playful confidence — Ground → Flow → Rest</div>
    </div>
    <div style="margin-left:auto" class="row">
      <a class="btn ghost" href="https://campus.plnt.earth/map#school=honey">Campus</a>
      <a class="btn dark" id="todayBtn">Today Room</a>
    </div>
  </header>

  <main class="grid">
    <!-- Left: Player + Queue -->
    <section class="card">
      <div class="bar"><span class="badge"><span class="dot"></span><b>Froot Player · Honey</b></span><span class="meta">Official titles via YouTube oEmbed</span></div>
      <div class="player section">
        <div id="yt"></div>
        <div class="title" id="nowTitle">—</div>
        <div class="controls">
          <button class="btn" id="prevBtn">Prev</button>
          <button class="btn" id="playBtn">Play</button>
          <button class="btn" id="nextBtn">Next</button>
          <button class="btn ghost" id="loopBtn">Loop: Off</button>
          <button class="btn ghost" id="clearBtn">Clear</button>
          <span class="meta small" id="countLine">0 in queue</span>
        </div>

        <div class="row" style="margin-top:10px">
          <input id="idInput" class="input" placeholder="Add YouTube ID (e.g., WZzcY7ASQno)">
          <button class="btn" id="addBtn">Add</button>
          <button class="btn ghost" id="csvBtn">Paste CSV</button>
        </div>
        <div class="meta small">CSV format: <code>id,title (optional)</code> — titles auto-fetched if blank.</div>

        <div class="list" id="queueList" aria-label="Queue"></div>
      </div>
    </section>

    <!-- Right: Tone + Ritual -->
    <aside class="card">
      <div class="bar"><span class="badge"><span class="dot" style="background:#ffe5a8"></span><b>Tone Studio</b></span><span class="meta">128.15 Hz · Honey bed</span></div>
      <div class="tone section">
        <div class="mini">
          <button class="btn" id="toneToggle">Tone: Off</button>
          <label class="pill">Vol <input id="vol" type="range" min="0" max="1" step="0.01" value="0.35" class="slider"></label>
          <label class="pill">Freq <input id="freq" type="number" step="0.01" value="128.15" style="width:92px;background:transparent;color:var(--ink);border:0"></label>
          <button class="btn ghost" id="muteBtn">Mute</button>
        </div>
        <div class="timer" style="margin-top:10px">
          <button class="btn ghost" data-min="2" id="t2">2-min</button>
          <button class="btn ghost" data-min="5" id="t5">5-min</button>
          <span class="meta" id="tline">Timer: —</span>
        </div>
      </div>

      <div class="bar"><span class="badge"><span class="dot" style="background:#ffd782"></span><b>Honey Ritual</b></span><span class="meta">2–5–2 minutes</span></div>
      <div class="rit section">
        <div class="step">
          <b>Ground (2)</b>
          <div class="meta">3 breaths with tone · one-line intention: “sweet spot today is ____.”</div>
        </div>
        <div class="step">
          <b>Flow (5–10)</b>
          <div class="meta">Play one video · note color/taste word · tiny movement that matches it.</div>
        </div>
        <div class="step">
          <b>Rest (2)</b>
          <div class="meta">One line reflection · star one moment worth repeating.</div>
        </div>
      </div>
    </aside>
  </main>

  <div class="footer">Press <kbd>Space</kbd> to play/pause · <kbd>←/→</kbd> prev/next · <kbd>L</kbd> loop · Data saves locally.</div>
</div>

<script>
(function(){
  /* ---------- State ---------- */
  var LS_KEY = "honey.queue.v1";
  var state = {
    queue: [],
    i: -1,
    loop:false,
    player:null,
    ready:false,
    tone:{ ctx:null, osc:null, gain:null, on:false, vol:0.35, freq:128.15, muted:false, timer:null, remain:0 }
  };

  /* ---------- Helpers ---------- */
  function $(s,el){return (el||document).querySelector(s)}
  function el(tag,cls,html){ var x=document.createElement(tag); if(cls)x.className=cls; if(html!=null)x.innerHTML=html; return x; }
  function save(){ localStorage.setItem(LS_KEY, JSON.stringify({q:state.queue, i:state.i, loop:state.loop})); }
  function load(){ try{var v=JSON.parse(localStorage.getItem(LS_KEY)||"{}"); state.queue=v.q||[]; state.i=(typeof v.i==="number"?v.i:-1); state.loop=!!v.loop;}catch(e){} }

  /* ---------- Titles via oEmbed ---------- */
  function fetchTitle(id, cb){
    var u="https://www.youtube.com/oembed?format=json&url=https://www.youtube.com/watch?v="+encodeURIComponent(id);
    fetch(u).then(r=>r.ok?r.json():null).then(j=>cb(j&&j.title?j.title:null)).catch(function(){ cb(null); });
  }

  /* ---------- Queue UI ---------- */
  function renderList(){
    var box=$("#queueList"); box.innerHTML="";
    state.queue.forEach(function(it,idx){
      var row=el("div","item"); if(idx===state.i) row.setAttribute("aria-current","true");
      row.appendChild(el("div","num", String(idx+1)));
      row.appendChild(el("div","", '<b>'+escapeHtml(it.title||it.id)+'</b><div class="meta small">'+it.id+'</div>'));
      var playBtn=el("button","btn ghost small","Play"); playBtn.addEventListener("click", function(){ playIndex(idx,true); });
      var delBtn=el("button","btn dark small","Remove"); delBtn.addEventListener("click", function(){ removeAt(idx); });
      var side=el("div","row"); side.appendChild(playBtn); side.appendChild(delBtn);
      row.appendChild(side);
      box.appendChild(row);
    });
    $("#countLine").textContent = state.queue.length+" in queue";
    $("#nowTitle").textContent = (state.queue[state.i] ? (state.queue[state.i].title||state.queue[state.i].id) : "—");
    $("#loopBtn").textContent = "Loop: " + (state.loop?"On":"Off");
  }
  function removeAt(idx){
    state.queue.splice(idx,1);
    if(state.i>=state.queue.length) state.i=state.queue.length-1;
    save(); renderList();
  }
  function addId(id,title){
    if(!id) return;
    var item={id:String(id).trim(), title:title||""};
    if(!title){
      fetchTitle(item.id, function(t){ item.title=t||item.id; save(); renderList(); });
    }
    state.queue.push(item);
    save(); renderList();
  }
  function addCSV(text){
    text.split(/\r?\n/).forEach(function(line){
      var s=line.trim(); if(!s) return;
      var parts=s.split(",");
      var id=(parts[0]||"").trim(); var title=(parts.slice(1).join(",")||"").trim();
      if(id) addId(id, title);
    });
  }
  function escapeHtml(s){ return s.replace(/[&<>"]/g,function(c){return({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;"}[c])}); }

  /* ---------- YouTube ---------- */
  function ensureAPI(onready){
    if(window.YT && YT.Player) return onready();
    var tag=document.createElement("script"); tag.src="https://www.youtube.com/iframe_api";
    document.head.appendChild(tag);
    window.onYouTubeIframeAPIReady=function(){ onready(); };
  }
  function initPlayer(){
    state.player=new YT.Player("yt",{
      videoId: state.queue[state.i]?state.queue[state.i].id:null,
      playerVars:{rel:0,modestbranding:1,playsinline:1},
      events:{
        onReady:function(){ state.ready=true; if(state.i<0 && state.queue.length) { state.i=0; save(); renderList(); } },
        onStateChange:function(e){
          /* 0=ended,1=playing,2=paused,3=buffering,5=cued */
          if(e.data===0) next(true);
        }
      }
    });
  }
  function playIndex(idx, autoplay){
    if(!state.queue.length) return;
    state.i = Math.max(0, Math.min(idx, state.queue.length-1));
    var id=state.queue[state.i].id;
    if(state.player && state.ready){
      state.player.loadVideoById(id);
      if(!autoplay){ state.player.pauseVideo(); }
    }
    save(); renderList();
  }
  function play(){ if(state.player && state.ready){ state.player.playVideo(); } }
  function pause(){ if(state.player && state.ready){ state.player.pauseVideo(); } }
  function togglePlay(){
    if(!state.player||!state.ready) return;
    var s = state.player.getPlayerState();
    if(s===1) pause(); else play();
  }
  function next(auto){
    if(!state.queue.length) return;
    if(state.loop){ playIndex(state.i, true); return; }
    var n = state.i+1;
    if(n>=state.queue.length) n=0;
    playIndex(n, true);
  }
  function prev(){
    if(!state.queue.length) return;
    var n = state.i-1; if(n<0) n=state.queue.length-1;
    playIndex(n, true);
  }

  /* ---------- Tone Studio (WebAudio) ---------- */
  function ensureAudio(){
    if(state.tone.ctx) return;
    var ctx=new (window.AudioContext||window.webkitAudioContext)();
    var osc=ctx.createOscillator();
    var gain=ctx.createGain();
    osc.type="sine"; osc.frequency.value=state.tone.freq;
    gain.gain.value=state.tone.vol;
    osc.connect(gain).connect(ctx.destination);
    state.tone.ctx=ctx; state.tone.osc=osc; state.tone.gain=gain;
    osc.start();
    state.tone.on=false; updateToneButton();
  }
  function updateTone(){
    if(state.tone.osc){ state.tone.osc.frequency.value = Number($("#freq").value)||128.15; }
    state.tone.freq = Number($("#freq").value)||128.15;
    state.tone.vol = Number($("#vol").value)||0.35;
    if(state.tone.gain){ state.tone.gain.gain.value = state.tone.muted?0:state.tone.vol; }
  }
  function updateToneButton(){ $("#toneToggle").textContent = "Tone: " + (state.tone.on?"On":"Off"); }
  function toggleTone(){
    ensureAudio();
    state.tone.on=!state.tone.on;
    state.tone.gain.gain.value = state.tone.on && !state.tone.muted ? state.tone.vol : 0;
    updateToneButton();
  }
  function toggleMute(){
    ensureAudio();
    state.tone.muted=!state.tone.muted;
    state.tone.gain.gain.value = (state.tone.on && !state.tone.muted) ? state.tone.vol : 0;
    $("#muteBtn").textContent = state.tone.muted?"Unmute":"Mute";
  }

  /* ---------- Timer ---------- */
  function startTimer(min){
    if(state.tone.timer){ clearInterval(state.tone.timer); state.tone.timer=null; }
    state.tone.remain = Math.round(min*60);
    $("#tline").textContent = "Timer: "+fmt(state.tone.remain);
    state.tone.timer = setInterval(function(){
      state.tone.remain--;
      if(state.tone.remain<=0){ clearInterval(state.tone.timer); state.tone.timer=null; state.tone.on=false; updateToneButton(); toggleTone(); $("#tline").textContent="Timer: done"; return; }
      $("#tline").textContent = "Timer: "+fmt(state.tone.remain);
    },1000);
  }
  function fmt(s){ var m=Math.floor(s/60), r=s%60; return String(m).padStart(2,"0")+":"+String(r).padStart(2,"0"); }

  /* ---------- Today Room ---------- */
  var cycles=[
    {s:"2025-11-05",e:"2025-12-17"},
    {s:"2026-01-03",e:"2026-02-14"},
    {s:"2026-03-03",e:"2026-04-14"},
    {s:"2026-05-01",e:"2026-06-12"},
    {s:"2026-06-30",e:"2026-08-11"},
    {s:"2026-08-29",e:"2026-10-10"},
    {s:"2026-10-28",e:"2026-12-09"}
  ];
  function P(d){var a=d.split("-");return new Date(+a[0],+a[1]-1,+a[2]);}
  function todayRoom(){
    var now=new Date();
    for(var i=0;i<cycles.length;i++){
      var A=P(cycles[i].s), B=P(cycles[i].e);
      if(now>=A && now<=B){
        var diff=Math.floor((now-A)/86400000)+1; if(diff<1)diff=1; if(diff>42)diff=42;
        return diff;
      }
    }
    return 1;
  }

  /* ---------- Init ---------- */
  load();
  ensureAPI(initPlayer);
  renderList();

  /* ---------- Events ---------- */
  $("#addBtn").addEventListener("click", function(){
    var id=$("#idInput").value.trim(); if(!id) return;
    $("#idInput").value=""; addId(id,"");
  });
  $("#csvBtn").addEventListener("click", function(){
    var txt=prompt("Paste CSV lines (id,title optional)");
    if(txt){ addCSV(txt); }
  });
  $("#prevBtn").addEventListener("click", prev);
  $("#nextBtn").addEventListener("click", next);
  $("#playBtn").addEventListener("click", togglePlay);
  $("#loopBtn").addEventListener("click", function(){ state.loop=!state.loop; save(); renderList(); });
  $("#clearBtn").addEventListener("click", function(){ state.queue=[]; state.i=-1; save(); renderList(); });
  $("#todayBtn").addEventListener("click", function(){
    var r=todayRoom(); location.href="https://campus.plnt.earth/map#school=honey&room="+r;
  });

  $("#toneToggle").addEventListener("click", toggleTone);
  $("#muteBtn").addEventListener("click", toggleMute);
  $("#vol").addEventListener("input", updateTone);
  $("#freq").addEventListener("change", updateTone);
  $("#idInput").addEventListener("keydown", function(e){ if(e.key==="Enter"){ $("#addBtn").click(); } });

  document.addEventListener("keydown", function(e){
    if(e.target && (e.target.tagName==="INPUT" || e.target.tagName==="TEXTAREA")) return;
    if(e.key===" "){ e.preventDefault(); togglePlay(); }
    if(e.key==="ArrowRight"){ next(); }
    if(e.key==="ArrowLeft"){ prev(); }
    if(e.key==="l"||e.key==="L"){ state.loop=!state.loop; save(); renderList(); }
  }, {passive:false});
})();
</script>
</body>
</html>
